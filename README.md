# Отчет о проведенном исследовании производительности CLI-приложения

## Введение

В рамках данного исследования мы провели анализ производительности нашего CLI-приложения с использованием инструментов мониторинга **Prometheus** и **Grafana**.

## Методология

Для сбора и визуализации данных о производительности мы использовали следующие шаги:

1. **Настройка Prometheus**:
   - Установили и настроили Prometheus для сбора метрик из нашего CLI-приложения.
   - Настроили **exporter** для отправки метрик, таких как утилизация памяти, время обработки строк и количество обработанных строк.

2. **Настройка Grafana**:
   - Установили Grafana для визуализации собранных метрик.
   - Создали дашборд с необходимыми графиками и панелями для отображения производительности CLI-приложения.

3. **Сбор данных**:
   - Запустили CLI-приложение под нагрузкой, чтобы собрать метрики за определенный период времени.
   - Собрали данные о:
     - Утилизации памяти (в байтах)
     - Времени обработки каждой строки (в миллисекундах)
     - Количестве обработанных строк (счетчик)

## Результаты

- **Утилизация памяти**: На графике видно, что по-началу потребление памяти было огромным. Это скорее всего связано с функией repository.ReadFromFile. Там создается строка из массива байт, то есть мы два раза выделяем память для одних и тех же данных. Также дальше виден большой спад, но память продолжает выделяется. Связано с тем, что мы еще не закончили выход из программы и Prometheus продолжает сбор метрик, что и вызывает аллокацию памяти. **Файл 50MB**
  ```go
  // repository.ReadFromFile
   newFile := &file.File{
		Name: File.Name(),
		Size: fileInfo.Size(),
		Mode: fileInfo.Mode(),
		ModificationTime: fileInfo.ModTime(),
		Content: string(bytes), // вот тут происходит выделени памяти
	}
  ```
  
- **Время обработки строк**: пока невозможен в связи с 
   ```go
   bytes, err := io.ReadAll(File)
   ```
   Читаем весь файл челиком, а не по строкам.
- **Количество обработанных строк**: то же самое

### Графики

1. **Утилизация памяти**: ![Memory Utilization](grafana.png)

## Выводы

Исследование показало, что производительность CLI-приложения находится на приемлемом уровне, но есть возможность для оптимизации. Основные выводы включают:

- Наблюдаемые пики в утилизации памяти могут быть связаны с определенными операциями обработки данных.
- Оптимизация алгоритма обработки строк может значительно снизить время обработки.

## Рекомендации

1. Оптимизировать алгоритмы обработки данных для снижения времени выполнения.
2. Провести дополнительные тесты для анализа производительности при различных уровнях нагрузки.
3. Рассмотреть возможность добавления новых метрик для более детального анализа производительности.

---